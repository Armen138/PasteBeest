/*! PasteBeest 2013-07-23 */
function main(a,b){var c=b.collection("pastes");app.set("title","PasteBeest"),app.use(express.logger()),app.use(express.bodyParser()),app.get(/^\/[\dA-F]+?$/,function(a,b){var d=a.path.substr(1);c.findOne({id:d},function(d,e){if(d||null===e)b.status(404).send(index({id:a.path.substr(1),code:"Paste Not Found",language:"javascript"}));else{e.views++,c.save(e,function(a){if(a)throw a});var f=index({id:a.path.substr(1),code:e.code,language:e.language,views:e.views});b.setHeader("Content-Type","text/html"),b.setHeader("Content-Length",f.length),b.end(f)}})}),app.get("/",function(a,b){var c=index({id:"",code:"",language:"javascript"});b.setHeader("Content-Type","text/html"),b.setHeader("Content-Length",c.length),b.end(c)}),app.post("/",function(a,b){c.count(function(d,e){var f=record.create(a.body.code,e.toString(16).toUpperCase(),null,a.body.language);c.insert(f,function(){b.redirect("/"+f.id)})})}),app.use(express.static(__dirname+"/public"));var d=process.env.OPENSHIFT_NODEJS_IP||"127.0.0.1",e=process.env.OPENSHIFT_NODEJS_PORT||9999;app.listen(e,d),console.log("PasteBeest Online at "+d+":"+e)}var mongo=require("mongodb").MongoClient,express=require("express"),jade=require("jade"),fs=require("fs"),settings=require("./settings.js"),app=express(),index=jade.compile(fs.readFileSync("templates/index.jade")),record={create:function(a,b,c,d){return{id:b,name:c||"guest",code:a||"//no code here",language:d||"javascript",timestamp:Date.now(),views:0}}};mongo.connect("mongodb://"+settings.prefix+settings.host+":"+settings.port+"/"+settings.db,main);